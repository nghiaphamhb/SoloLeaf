(function(){"use strict";function l(r){return(r||"").toString().toLowerCase().trim()}function m(r){return l(r).split(/\s+/).filter(Boolean)}function a(r,n,e){const s=l(r?.title);if(!s)return 0;let t=0;for(const i of n)i&&(s===i?t+=50:s.startsWith(i)?t+=30:s.includes(i)&&(t+=20));e?.preferFreeShip&&r?.freeShip&&(t+=8);const c=Number(r?.rating??0);Number.isNaN(c)||(t+=Math.min(5,c)*2);const o=Number(r?.price??0);if(!Number.isNaN(o)){const i=e?.minPrice!=null?Number(e.minPrice):null,u=e?.maxPrice!=null?Number(e.maxPrice):null;i!=null&&o<i&&(t-=6),u!=null&&o>u&&(t-=6)}return t}function _(r){return r.map((n,e)=>({...n,__idx:e})).sort((n,e)=>e.__score!==n.__score?e.__score-n.__score:n.__idx-e.__idx).map(({__idx:n,...e})=>e)}self.onmessage=r=>{const n=r?.data||{},{reqId:e,query:s,items:t,options:c}=n,o=m(s),i=(t||[]).map(f=>{const N=a(f,o,c);return{...f,__score:N}}),u=_(i);self.postMessage({reqId:e,items:u})}})();
