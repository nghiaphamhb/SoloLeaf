<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Đăng ký</title>
    <link rel="icon" type="image/png" th:href="@{/favicon.png}" href="/favicon.png" sizes="32x32">
    <link rel="stylesheet" th:href="@{/css/index.css}" href="/css/index.css">
    <link rel="stylesheet" th:href="@{/css/sign.css}" href="/css/sign.css">
</head>
<body>
<header>
    <h3>Đăng ký ngay để đặt hàng và thưởng thức các món ăn nóng hổi!</h3>
</header>

<main class="wrap">
    <div>
        <h1>Đăng ký</h1>

        <form id="form-signup">
            <label for="fullname">Họ tên</label>
            <input id="fullname" type="text" required placeholder="Nhập họ và tên của bạn" />

            <label for="email">Email</label>
            <input id="email" type="email" required placeholder="Nhập email của bạn" />

            <label for="password">Mật khẩu</label>
            <input id="password" type="password" required minlength="6" placeholder="Nhập mật khẩu" />

            <label for="confirm">Xác nhận mật khẩu</label>
            <input id="confirm" type="password" required minlength="6" placeholder="Xác nhận mật khẩu" />

            <button id="btn-signup" type="submit">Tạo tài khoản</button>
        </form>
    </div>

</main>

<footer>
    <p>Đã có tài khoản? <a href="/signIn" th:href="@{/signIn}">Đăng nhập ngay</a></p>
</footer>

<!-- jQuery CDN -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    $("#form-signup").on("submit", function (e) {
        e.preventDefault();

        var fullname = $("#fullname").val();
        var email = $("#email").val();
        var password = $("#password").val();
        var confirm = $("#confirm").val();

        // Kiểm tra mật khẩu xác nhận
        if (password !== confirm) {
            alert("Mật khẩu xác nhận không khớp!");
            return;
        }

        // Gửi dữ liệu dưới dạng JSON
        $.ajax({
            method: "POST",
            url: "/api/login/signUp",
            contentType: "application/json",
            data: JSON.stringify({
                fullname: fullname,
                username: email,
                password: password,
                roleId: 1
            })
        })
            .done(function (msg) {
                if (msg && msg.data) {
                    window.location.href = "/";
                } else {
                    alert((msg && msg.message) || "Đăng ký thất bại!");
                }
            })
            .fail(function (xhr) {
                alert("Lỗi mạng/Server: " + (xhr.status || "") + " " + (xhr.responseText || ""));
            });
    });
</script>

</body>
</html>
